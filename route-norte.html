<script>
        document.addEventListener('DOMContentLoaded', function() {
            var map = L.map('map-detail-norte', {
                zoomControl: false, dragging: false, scrollWheelZoom: false, doubleClickZoom: false
            });
            L.tileLayer('https://{s}.basemaps.cartocdn.com/light_nolabels/{z}/{x}/{y}{r}.png').addTo(map);

            // CORRECTED: High-resolution coastal path to avoid water
            const pathNorte = [
                [43.33, -1.78], // Irún
                [43.31, -1.98], // San Sebastián
                [43.29, -2.35], // Deba
                [43.26, -2.93], // Bilbao
                [43.38, -3.22], // Castro Urdiales
                [43.41, -3.41], // Laredo
                [43.46, -3.80], // Santander
                [43.38, -4.29], // Comillas
                [43.42, -4.75], // Llanes
                [43.53, -5.66], // Gijón
                [43.55, -5.92], // Avilés
                [43.54, -6.53], // Luarca
                [43.55, -7.04], // Ribadeo (The turn South)
                [43.42, -7.36], // Mondoñedo
                [43.04, -8.02], // Sobrado
                [42.92, -8.16], // Arzúa (Join Francés)
                [42.88, -8.54]  // Santiago
            ];
            
            const redLineStyle = { color: '#dc2626', weight: 4, opacity: 0.8 };
            const line = L.polyline(pathNorte, redLineStyle).addTo(map);
            map.fitBounds(line.getBounds(), {padding: [40, 40]});

            window.setMode = function(mode) {
                const table = document.getElementById('stages-table');
                const btnSummer = document.getElementById('btn-summer');
                const btnWinter = document.getElementById('btn-winter');

                if (mode === 'summer') {
                    table.classList.remove('mode-winter');
                    btnSummer.classList.add('bg-white', 'shadow-sm', 'text-gray-800');
                    btnSummer.classList.remove('text-gray-500');
                    btnWinter.classList.remove('bg-white', 'shadow-sm', 'text-gray-800');
                    btnWinter.classList.add('text-gray-500');
                } else {
                    table.classList.add('mode-winter');
                    btnWinter.classList.add('bg-white', 'shadow-sm', 'text-gray-800');
                    btnWinter.classList.remove('text-gray-500');
                    btnSummer.classList.remove('bg-white', 'shadow-sm', 'text-gray-800');
                    btnSummer.classList.add('text-gray-500');
                }
            };

            window.toggleMiddleStages = function() {
                const hiddenRows = document.getElementById('middle-stages');
                const triggerRow = document.getElementById('expand-trigger');
                hiddenRows.classList.remove('hidden');
                triggerRow.style.display = 'none';
            };
        });
    </script>
